# ITMO Containers 2024 - Streamlit App with PostgreSQL

Этот проект разворачивает веб-приложение на базе Streamlit и PostgreSQL с использованием Docker Compose. Он включает три основных компонента:
- **PostgreSQL**: База данных для хранения данных.
- **Streamlit App**: Веб-приложение для взаимодействия с пользователем.
- **init_db**: Сервис для инициализации базы данных (создание таблиц).

## Требования

Для запуска проекта на вашем компьютере должны быть установлены следующие инструменты:
- [Docker](https://www.docker.com/get-started)
- [Docker Compose](https://docs.docker.com/compose/install/)
- (опционально) [Poetry](https://python-poetry.org/) для управления зависимостями.

## Настройка окружения

Для корректной работы приложения необходимо настроить несколько переменных окружения. Для этого создайте файл `.env` в корневой директории проекта и заполните его значениями:

```bash
POSTGRES_USER=your_postgres_user
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_DB=your_database_name
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
MODEL_NAME=your_model_name
STREAMLIT_PORT=8501
```

Замените `your_postgres_user`, `your_postgres_password`, `your_database_name` и другие значения на актуальные данные.

## Структура проекта

```
.
├── db.py               # Логика работы с базой данных
├── docker-compose.yml  # Docker Compose конфигурация
├── Dockerfile          # Файл для сборки контейнера Streamlit
├── poetry.lock         # Файл lock для Poetry
├── pyproject.toml      # Конфигурация Poetry
├── README.md           # Документация проекта
├── requirements.txt    # Зависимости для проекта (если не используете Poetry)
├── streamlit_app.py    # Основной файл приложения Streamlit
```

## Установка зависимостей

Вы можете использовать Poetry для управления зависимостями. Если вы используете Poetry, выполните:

```bash
poetry install
```

Если вы предпочитаете использовать `requirements.txt`, то просто выполните:

```bash
pip install -r requirements.txt
```

## Запуск проекта

1. **Сборка и запуск контейнеров**

   После настройки файла `.env` и установки зависимостей, можно запустить проект с помощью Docker Compose. В терминале выполните:

   ```bash
   sudo docker-compose up --build -d
   ```

   Эта команда соберет образы и запустит все сервисы в фоновом режиме.

2. **Проверка состояния контейнеров**

   Чтобы проверить, что контейнеры запущены и работают правильно, используйте команду:

   ```bash
   sudo docker-compose ps
   ```

3. **Остановка и удаление контейнеров**

   Для остановки и удаления контейнеров используйте команду:

   ```bash
   sudo docker-compose down
   ```

## Описание сервисов

### PostgreSQL

- **Контейнер**: `my_postgres`
- **Порты**: 5432 (по умолчанию)
- **Переменные окружения**:
  - `POSTGRES_USER`: Имя пользователя для PostgreSQL
  - `POSTGRES_PASSWORD`: Пароль для пользователя
  - `POSTGRES_DB`: Имя базы данных
- **Зависимости**: контейнер зависит от `init_db` и `streamlit_app`.

### Streamlit App

- **Контейнер**: `streamlit_app`
- **Порты**: Настроенные через переменную окружения `STREAMLIT_PORT` (по умолчанию 8501)
- **Переменные окружения**:
  - Все переменные для подключения к базе данных PostgreSQL
  - `MODEL_NAME`: Название модели для использования
- **Зависимости**: контейнер зависит от `postgres`.

### init_db

- **Контейнер**: `init_db`
- **Назначение**: Инициализация базы данных. Создание таблиц и начальная настройка.
- **Команда**: Выполняет SQL-запрос для создания таблицы логов в базе данных.

## Примечания

- **Переменные окружения**: Все важные параметры конфигурации задаются через переменные окружения в файле `.env`.
- **Зависимости**: Контейнеры автоматически запускаются в нужном порядке благодаря директиве `depends_on` в `docker-compose.yml`.
